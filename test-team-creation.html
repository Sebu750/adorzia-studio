<!DOCTYPE html>
<html>
<head>
    <title>Test Team Creation</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Test Team Creation</h1>
    <button onclick="testCreateTeam()">Create Test Team</button>
    <div id="output"></div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://lnrhrevpouozugsarsmz.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxucmhyZXZwb3VvenVnc2Fyc216Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM3NTM5OTUsImV4cCI6MjA0OTMyOTk5NX0.xJQYqPuJl0gTGZkQqZQU4eBo-YZFRf5OhZFQ7fRN7xg'
        const { createClient } = supabase
        const client = createClient(supabaseUrl, supabaseKey)

        async function testCreateTeam() {
            const output = document.getElementById('output')
            output.innerHTML = '<p>Testing team creation...</p>'

            try {
                // First check if user is authenticated
                const { data: { user }, error: userError } = await client.auth.getUser()
                
                if (userError || !user) {
                    output.innerHTML += '<p style="color: red;">Error: Not authenticated. Please sign in first.</p>'
                    output.innerHTML += '<p>Error details: ' + JSON.stringify(userError) + '</p>'
                    return
                }

                output.innerHTML += '<p style="color: green;">User authenticated: ' + user.email + '</p>'

                // Try to invoke the manage-team function
                const { data, error } = await client.functions.invoke('manage-team', {
                    body: {
                        action: 'create',
                        name: 'Test Team ' + Date.now(),
                        description: 'This is a test team',
                        category: 'fashion',
                        max_members: 5,
                        is_open: true
                    }
                })

                if (error) {
                    output.innerHTML += '<p style="color: red;">Function invocation error:</p>'
                    output.innerHTML += '<pre>' + JSON.stringify(error, null, 2) + '</pre>'
                } else {
                    output.innerHTML += '<p style="color: green;">Success!</p>'
                    output.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>'
                }
            } catch (err) {
                output.innerHTML += '<p style="color: red;">Exception:</p>'
                output.innerHTML += '<pre>' + err.toString() + '</pre>'
            }
        }
    </script>
</body>
</html>
